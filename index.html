<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LUXE BAR - Welcome</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;800&family=Jost:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-dark: #b38e21;
            --dark-bg: #0a0a0a;
            --off-white: #f3f3f3;
            --card-bg: rgba(18, 18, 18, 0.85);
        }
        html, body {
            height: 100%;
            margin: 0;
            overflow-y: auto;
            overflow-x: hidden;
        }
        body {
            font-family: 'Jost', sans-serif;
            color: var(--off-white);
            background-color: var(--dark-bg);
            position: relative;
        }
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        #app-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }
        .page-content { display: none; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page-content.active {
            display: flex;
            justify-content: center;
            width: 100%;
            animation: fadeInUp 0.6s ease-out forwards;
        }
        .card {
            background-color: var(--card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(212, 175, 55, 0.25);
            border-radius: 1.25rem;
            padding: 2.5rem;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5), 0 0 40px rgba(212, 175, 55, 0.1) inset;
            width: 100%;
            max-width: 800px;
        }
        .logo {
            font-family: 'Cinzel', serif;
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            font-weight: 800;
            color: var(--gold);
            text-align: center;
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
        .page-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            text-align: center;
            margin-bottom: 2rem;
            color: var(--off-white);
        }
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 1rem 1.75rem;
            border-radius: 0.75rem; font-weight: 600;
            transition: all .3s ease;
            cursor: pointer; border: 1px solid var(--gold); text-align: center;
            text-transform: uppercase; letter-spacing: 1px;
            font-size: 1.1rem;
        }
        .btn-primary { 
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            color: #111; 
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
        }
        .btn-secondary {
            background: transparent;
            color: var(--gold);
        }
        .btn-secondary:hover {
            background: rgba(212, 175, 55, 0.15);
        }
        .custom-select {
            width: 100%;
            padding: 1rem;
            background-color: rgba(0,0,0,0.5);
            border: 1px solid rgba(212, 175, 55, 0.4);
            border-radius: 0.75rem;
            color: var(--off-white);
            font-size: 1.1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23D4AF37' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 1rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }
        .back-button { 
            position: absolute; top: 1.25rem; left: 1.25rem; 
            background: rgba(0,0,0,0.3); 
            border: 1px solid rgba(212, 175, 55, 0.3);
            cursor: pointer; color: var(--gold); 
            font-weight: 700; font-size: 1.2rem; line-height: 1;
            width:40px; height:40px; border-radius:.75rem; 
            display:flex; align-items:center; justify-content:center; 
            z-index: 10;
        }
        .explanation-section {
            border-left: 3px solid var(--gold);
            padding-left: 1.5rem;
            margin-bottom: 2rem;
        }
        .explanation-section h3 {
            font-family: 'Cinzel', serif;
            color: var(--gold);
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }
        .explanation-section ul li {
            position: relative;
            padding-left: 1.75rem;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
        }
        .explanation-section ul li::before {
            content: '◆';
            position: absolute;
            left: 0;
            color: var(--gold);
        }
        .price-item {
            color: var(--gold);
            font-weight: 600;
        }
        #customer-id-display {
            background: linear-gradient(145deg, var(--gold), var(--gold-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
        }
        #qrcode-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
            background-color: var(--off-white);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid var(--gold);
        }
    </style>
</head>
<body>
    <canvas id="background-canvas"></canvas>

    <div id="app-container">
        <!-- Staff Setup Page -->
        <div id="page-staff-config" class="page-content active">
            <div class="card">
                <h1 class="logo">LUXE</h1>
                <h2 class="page-title">スタッフ価格設定</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label for="price-select" class="block mb-2 font-semibold">料金プラン（40分・税込）</label>
                        <select id="price-select" class="custom-select"></select>
                        <input type="number" id="custom-price-input" class="custom-select mt-2 hidden" placeholder="カスタム金額を入力" min="0" step="1000">
                    </div>
                    <div>
                        <label for="source-select" class="block mb-2 font-semibold">お客様の来店経路</label>
                        <select id="source-select" class="custom-select">
                            <option>フロントクーポン</option><option>フリー</option><option>web</option><option>Google</option><option>外販</option><option>スレッズ</option>
                        </select>
                    </div>
                </div>
                <div class="text-center">
                    <button id="staff-confirm-btn" class="btn btn-primary">確定して説明開始</button>
                </div>
            </div>
        </div>

        <!-- Language Selection Page -->
        <div id="page-language" class="page-content">
            <div class="card">
                <button onclick="goBack()" class="back-button">‹</button>
                <h1 class="logo">LUXE</h1>
                <h2 class="page-title" data-translate-key="select_language_title"></h2>
                <div class="flex flex-col space-y-4 max-w-md mx-auto">
                    <select id="language-select" class="custom-select"></select>
                    <button id="language-continue-btn" class="btn btn-primary text-lg" data-translate-key="continue_btn"></button>
                </div>
            </div>
        </div>

        <!-- Pricing Page -->
        <div id="page-pricing" class="page-content">
            <div class="card">
                <button onclick="goBack()" class="back-button">‹</button>
                <h1 class="logo" data-translate-key="pricing_title"></h1>
                <div class="explanation-section">
                    <h3 data-translate-key="main_service_fee"></h3>
                    <ul><li><span data-translate-key="service_duration"></span> <span id="display-price" class="price-item"></span></li></ul>
                </div>
                <p class="text-center text-amber-300 italic my-6 text-lg" data-translate-key="extension_fee_note"></p>
                <div class="explanation-section">
                    <h3 data-translate-key="optional_fees_title"></h3>
                    <ul data-translate-key="pricing_list"></ul>
                </div>
                 <div class="text-center mt-8">
                    <button onclick="showPage('page-instructions')" class="btn btn-primary text-lg" data-translate-key="continue_btn"></button>
                </div>
            </div>
        </div>
        
        <!-- Instructions Page -->
        <div id="page-instructions" class="page-content">
            <div class="card">
                <button onclick="goBack()" class="back-button">‹</button>
                 <h1 class="logo" data-translate-key="instructions_title"></h1>
                 <p class="text-center text-xl mb-6 -mt-2" data-translate-key="instructions_subtitle"></p>
                 <div class="explanation-section">
                    <h3 data-translate-key="included_services"></h3>
                    <ul id="instructions-list-container"></ul>
                </div>
                <p class="text-center text-amber-300 italic mt-6 text-lg" data-translate-key="drink_incentive_text"></p>
                <div class="text-center mt-8">
                    <button onclick="showPage('page-rules')" class="btn btn-primary text-lg" data-translate-key="continue_to_rules_btn"></button>
                </div>
            </div>
        </div>
        
        <!-- Rules Page -->
        <div id="page-rules" class="page-content">
            <div class="card text-center">
                <button onclick="goBack()" class="back-button">‹</button>
                <svg class="mx-auto h-16 w-16 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
                <h3 class="text-2xl font-bold mt-4" data-translate-key="rules_warning_title"></h3>
                <p class="mt-2" data-translate-key="rules_warning_text"></p>
                <div id="rules-list-container" class="mt-4 text-left space-y-3 text-lg"></div>
                <div class="text-center mt-8">
                    <button onclick="showPage('page-final')" class="btn btn-primary text-lg" data-translate-key="agree_btn"></button>
                </div>
            </div>
        </div>

        <!-- Final Page -->
        <div id="page-final" class="page-content">
             <div class="card text-center">
                 <h1 class="logo" data-translate-key="customer_id_title"></h1>
                 <p class="mb-4" data-translate-key="customer_id_instructions"></p>
                 <div id="qrcode-container"></div>
                 <h2 id="customer-id-display"></h2>
                 <div class="flex flex-col sm:flex-row justify-center gap-4 mt-6">
                    <button onclick="nextCustomer()" class="btn btn-primary" data-translate-key="next_customer_btn"></button>
                    <button onclick="restartFlow()" class="btn btn-secondary" data-translate-key="finish_session_btn"></button>
                 </div>
             </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        let currentLanguage = 'en';
        let pageHistory = [];
        let selectedPriceInfo = { value: 13000, isVip: false };
        let selectedSource = 'フロントクーポン';

        // --- TRANSLATIONS ---
        const translations = {
            'en': {
                select_language_title: "Select Your Language", continue_btn: "Continue",
                pricing_title: "Price Information", main_service_fee: "Main Service Fee", service_duration: "40-Minute Session",
                extension_fee_note: "Discounts apply only to the first session. Extensions are charged at the standard rate.",
                optional_fees_title: "Optional Fees",
                fee_extension_std: "40-Min Extension", fee_extension_vip: "40-Min VIP Extension",
                fee_drink: "Girl's Drink", fee_shot: "Shot for Girl", fee_nomination: "Nomination Fee", fee_change: "Girl Change Fee", fee_bottle: "Bottle Fee",
                instructions_title: "How to Enjoy", instructions_subtitle: "To make your time unforgettable...",
                included_services: "Included Services",
                instructions_list_std: `<li>40 mins with a rotation of 2-3 girls.</li><li>Freely touch, kiss, and lick their upper body.</li><li>Unlimited beer, shochu, whiskey, & soft drinks.</li><li>Staff will notify you when time is nearly up.</li>`,
                instructions_list_vip: `<li>Enjoy your time in a private VIP room.</li><li>Freely touch, kiss, and lick their entire body.</li><li>Unlimited beer, shochu, whiskey, & soft drinks.</li><li>Staff will notify you when time is nearly up.</li>`,
                drink_incentive_text: "Buying drinks for the girls is optional, but they will be very happy and more eager to please you if you do!",
                continue_to_rules_btn: "View Rules",
                rules_warning_title: "【Important】House Rules",
                rules_warning_text: "For a safe and fun time for everyone, please observe the following:",
                rules_list_std: `<li>Do not harm the girls.</li><li>Touching their lower body is prohibited.</li><li>Failure to follow rules will result in immediate removal.</li>`,
                rules_list_vip: `<li>Do not harm the girls.</li><li>Please be gentle and respectful at all times.</li><li>Failure to follow rules will result in immediate removal.</li>`,
                agree_btn: "I Understand & Agree", 
                customer_id_title: "Your Customer ID",
                customer_id_instructions: "Please scan this QR code with your phone to get your digital membership card.",
                next_customer_btn: "Next Customer in Group",
                finish_session_btn: "Finish & New Session",
            },
            'ja': {
                select_language_title: "言語を選択してください", continue_btn: "続ける",
                pricing_title: "料金のご案内", main_service_fee: "基本料金", service_duration: "40分コース",
                extension_fee_note: "割引は最初のセットのみ適用されます。延長は通常料金となります。",
                optional_fees_title: "オプション料金",
                fee_extension_std: "40分延長", fee_extension_vip: "40分VIP延長",
                fee_drink: "女の子のドリンク", fee_shot: "女の子へのショット", fee_nomination: "本指名料", fee_change: "女の子のチェンジ料", fee_bottle: "ボトルキープ",
                instructions_title: "楽しみ方", instructions_subtitle: "最高の時間をお過ごしいただくために...",
                included_services: "含まれるサービス",
                instructions_list_std: `<li>40分間で2～3人の女の子が交代します。</li><li>上半身へのタッチ、キス、舐める行為はご自由に。</li><li>ビール、焼酎、ウイスキー、ソフトドリンクが飲み放題。</li><li>終了時間が近づいたらスタッフがお声がけします。</li>`,
                instructions_list_vip: `<li>VIP個室で特別な時間をお楽しみください。</li><li>女の子の全身へ自由に触れることができます。</li><li>ビール、焼酎、ウイスキー、ソフトドリンクが飲み放題。</li><li>終了時間が近づいたらスタッフがお声がけします。</li>`,
                drink_incentive_text: "ドリンクは任意ですが、女の子に買ってあげると大変喜び、サービスもより一層頑張ります！",
                continue_to_rules_btn: "ルールを確認",
                rules_warning_title: "【重要】ハウスルール",
                rules_warning_text: "皆様が安全に楽しむため、以下のルールをお守りください：",
                rules_list_std: `<li>女の子を傷つける行為は禁止です。</li><li>下半身へのタッチは禁止です。</li><li>ルール違反は即時退店となります。</li>`,
                rules_list_vip: `<li>女の子を傷つける行為は禁止です。</li><li>常に優しく、敬意を持って接してください。</li><li>ルール違反は即時退店となります。</li>`,
                agree_btn: "理解し、同意します",
                customer_id_title: "お客様ID",
                customer_id_instructions: "お使いの携帯電話でこのQRコードをスキャンし、デジタル会員証を取得してください。",
                next_customer_btn: "次のお客様（グループ）",
                finish_session_btn: "終了して新規受付",
            },
            'zh': {
                select_language_title: "请选择您的语言", continue_btn: "继续",
                pricing_title: "价格资讯", main_service_fee: "基本费用", service_duration: "40分钟套餐",
                extension_fee_note: "请注意：任何折扣仅适用于首次消费。所有延时均按标准费率收费。",
                optional_fees_title: "可选费用",
                fee_extension_std: "40分钟延时", fee_extension_vip: "40分钟VIP延时",
                fee_drink: "女孩的饮料", fee_shot: "给女孩的烈酒", fee_nomination: "指定费", fee_change: "更换女孩费用", fee_bottle: "存瓶费",
                instructions_title: "如何享乐", instructions_subtitle: "为了让您的时光难忘...",
                included_services: "包含的服务",
                instructions_list_std: `<li>40分钟内将有2-3位女孩轮换。</li><li>您可以自由触摸、亲吻和舔她们的上半身。</li><li>无限畅饮啤酒、烧酒、威士忌和软饮料。</li><li>时间快到时，我们的员工会通知您。</li>`,
                instructions_list_vip: `<li>在私人VIP房间里享受您的时光。</li><li>您可以自由触摸、亲吻和舔她们的全身。</li><li>无限畅饮啤酒、烧酒、威士忌和软饮料。</li><li>时间快到时，我们的员工会通知您。</li>`,
                drink_incentive_text: "您不是必须为女孩购买饮料，但如果您购买，她们会非常高兴并更愿意取悦您！",
                continue_to_rules_btn: "查看规则",
                rules_warning_title: "【重要】本店规则",
                rules_warning_text: "为确保大家有一个安全愉快的时间，请遵守以下规定：",
                rules_list_std: `<li>请勿以任何方式伤害女孩。</li><li>严禁触摸她们的下半身。</li><li>不遵守这些规则将导致立即被请离。</li>`,
                rules_list_vip: `<li>请勿以任何方式伤害女孩。</li><li>请始终温柔并尊重对方。</li><li>不遵守这些规则将导致立即被请离。</li>`,
                agree_btn: "我理解并同意",
                customer_id_title: "您的客户ID",
                customer_id_instructions: "请用手机扫描此二维码以获取您的电子会员卡。",
                next_customer_btn: "下一位客人（团体）",
                finish_session_btn: "完成并新开会话",
            },
            'ko': {
                select_language_title: "언어를 선택하세요", continue_btn: "계속하기",
                pricing_title: "가격 정보", main_service_fee: "기본 서비스 요금", service_duration: "40분 세션",
                extension_fee_note: "참고: 할인은 첫 40분 세션에만 적용됩니다. 모든 연장은 표준 요금으로 청구됩니다.",
                optional_fees_title: "선택 요금",
                fee_extension_std: "40분 연장", fee_extension_vip: "40분 VIP 연장",
                fee_drink: "아가씨 드링크", fee_shot: "아가씨 샷", fee_nomination: "지명료", fee_change: "아가씨 교체 비용", fee_bottle: "보틀 키핑",
                instructions_title: "즐기는 방법", instructions_subtitle: "잊지 못할 시간을 만들기 위해...",
                included_services: "포함된 서비스",
                instructions_list_std: `<li>40분 동안 2-3명의 아가씨가 교대로 들어옵니다.</li><li>상반신 터치, 키스, 핥기는 자유롭게 가능합니다.</li><li>맥주, 소주, 위스키, 소프트 드링크 무제한 제공.</li><li>시간이 다 되면 직원이 알려드립니다.</li>`,
                instructions_list_vip: `<li>개인 VIP 룸에서 시간을 즐기세요.</li><li>아가씨의 전신을 자유롭게 터치, 키스, 핥기 가능합니다.</li><li>맥주, 소주, 위스키, 소프트 드링크 무제한 제공.</li><li>시간이 다 되면 직원이 알려드립니다.</li>`,
                drink_incentive_text: "아가씨에게 음료를 사줄 의무는 없지만, 사주시면 매우 기뻐하며 더 즐겁게 해드릴 것입니다!",
                continue_to_rules_btn: "규칙 보기",
                rules_warning_title: "【중요】업소 규칙",
                rules_warning_text: "모두의 안전하고 즐거운 시간을 위해 다음을 준수해 주십시오:",
                rules_list_std: `<li>아가씨에게 어떤 식으로든 해를 끼치지 마십시오.</li><li>하반신 터치는 엄격히 금지됩니다.</li><li>규칙을 따르지 않을 경우 즉시 퇴장 조치됩니다.</li>`,
                rules_list_vip: `<li>아가씨에게 어떤 식으로든 해를 끼치지 마십시오.</li><li>항상 부드럽고 존중하는 태도를 보여주십시오.</li><li>규칙을 따르지 않을 경우 즉시 퇴장 조치됩니다.</li>`,
                agree_btn: "이해하고 동의합니다",
                customer_id_title: "고객 ID",
                customer_id_instructions: "휴대폰으로 이 QR 코드를 스캔하여 디지털 멤버십 카드를 받으세요.",
                next_customer_btn: "다음 고객 (그룹)",
                finish_session_btn: "세션 종료 및 새로 시작",
            }
        };
        const languageOptions = [
            { code: 'en', name: "English" }, { code: 'ja', name: "日本語" }, { code: 'zh', name: "中文 (简体)" }, { code: 'ko', name: "한국어" }
        ];

        // --- CORE FUNCTIONS ---
        function updateText() {
            const langPack = translations[currentLanguage] || translations['en'];
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (langPack[key]) el.innerHTML = langPack[key];
            });

            // Dynamic Content
            const extensionPrice = selectedPriceInfo.isVip ? 27000 : 13000;
            const extensionTextKey = selectedPriceInfo.isVip ? 'fee_extension_vip' : 'fee_extension_std';
            
            document.querySelector('[data-translate-key="pricing_list"]').innerHTML = `
                <li><span>${langPack[extensionTextKey]}</span><span class="price-item">¥${extensionPrice.toLocaleString()}</span></li>
                <li><span>${langPack['fee_drink']}</span><span class="price-item">¥3,000</span></li><li><span>${langPack['fee_shot']}</span><span class="price-item">¥4,000</span></li>
                <li><span>${langPack['fee_nomination']}</span><span class="price-item">¥4,000</span></li><li><span>${langPack['fee_change']}</span><span class="price-item">¥4,000</span></li>
                <li><span>${langPack['fee_bottle']}</span><span class="price-item">ASK</span></li>`;
            
            document.getElementById('display-price').textContent = `¥${selectedPriceInfo.value.toLocaleString()}`;
            
            const instructionsKey = selectedPriceInfo.isVip ? 'instructions_list_vip' : 'instructions_list_std';
            document.getElementById('instructions-list-container').innerHTML = langPack[instructionsKey];

            const rulesKey = selectedPriceInfo.isVip ? 'rules_list_vip' : 'rules_list_std';
            document.getElementById('rules-list-container').innerHTML = `<ul class="list-disc list-inside space-y-2">${langPack[rulesKey].split('<li>').slice(1).map(item => `<li>${item}`).join('')}</ul>`;
        }
        
        function showPage(pageId, isGoingBack = false) {
            const currentPage = document.querySelector('.page-content.active');
            if (currentPage && !isGoingBack) pageHistory.push(currentPage.id);
            document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
            
            if (pageId === 'page-final') generateAndDisplayCustomerID();

            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                updateText();
                window.scrollTo(0, 0);
            }
        }

        function goBack() {
            if (pageHistory.length > 0) {
                const prevPageId = pageHistory.pop();
                showPage(prevPageId, true);
            }
        }

        function restartFlow() {
            pageHistory = [];
            showPage('page-staff-config');
        }

        function nextCustomer() {
            // Instantly regenerate the ID and QR code for the next person in the group.
            generateAndDisplayCustomerID();
            window.scrollTo(0, 0); // Scroll to the top to make it clear the page has refreshed
        }

        function generateAndDisplayCustomerID() {
            const uniqueID = `LUXE-${Date.now()}-${Math.random().toString(36).substr(2, 5).toUpperCase()}`;
            document.getElementById('customer-id-display').textContent = uniqueID;

            const qrContainer = document.getElementById('qrcode-container');
            qrContainer.innerHTML = '';
            
            const cardUrl = `${window.location.href.split('luxe_guide.html')[0]}membership_card.html?id=${encodeURIComponent(uniqueID)}`;

            new QRCode(qrContainer, {
                text: cardUrl,
                width: 200, height: 200,
                colorDark: "#0a0a0a", colorLight: "#f3f3f3",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // --- INITIALIZATION ---
        function initStaffPage() {
            const priceSelect = document.getElementById('price-select');
            const customPriceInput = document.getElementById('custom-price-input');
            const prices = [
                { text: '¥0', value: 0 }, { text: '¥5,000', value: 5000 }, { text: '¥6,000', value: 6000 },
                { text: '¥7,000', value: 7000 }, { text: '¥8,000', value: 8000 }, { text: '¥10,000', value: 10000 },
                { text: '¥13,000 (通常)', value: 13000, isVip: false, selected: true },
                { text: '¥20,000 (VIP)', value: 20000, isVip: true }, { text: '¥27,000 (VIP)', value: 27000, isVip: true },
                { text: 'カスタム金額を入力', value: 'custom' }
            ];
            
            priceSelect.innerHTML = prices.map(p => `<option value="${p.value}" ${p.selected ? 'selected' : ''}>${p.text}</option>`).join('');

            priceSelect.addEventListener('change', () => {
                customPriceInput.classList.toggle('hidden', priceSelect.value !== 'custom');
            });

            document.getElementById('staff-confirm-btn').addEventListener('click', () => {
                const selectedOption = prices.find(p => p.value == priceSelect.value) || {};
                const value = priceSelect.value === 'custom' ? parseInt(customPriceInput.value) || 0 : parseInt(priceSelect.value);
                const isVip = selectedOption.isVip || value >= 20000;

                selectedPriceInfo = { value, isVip };
                selectedSource = document.getElementById('source-select').value;
                showPage('page-language');
            });
        }
        
        function initLanguagePage() {
            const langSelect = document.getElementById('language-select');
            langSelect.innerHTML = languageOptions.map(l => `<option value="${l.code}">${l.name}</option>`).join('');
            langSelect.addEventListener('change', (e) => { currentLanguage = e.target.value; updateText(); });
            document.getElementById('language-continue-btn').addEventListener('click', () => {
                currentLanguage = langSelect.value;
                showPage('page-pricing');
            });
        }
        
        function initBackground() {
            const canvas = document.getElementById('background-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            const resizeCanvas = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
            class Particle {
                constructor() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 1.5 + 0.5; this.speedX = Math.random() * 0.5 - 0.25; this.speedY = Math.random() * 0.5 - 0.25; this.opacity = Math.random() * 0.5 + 0.2; }
                update() { this.x += this.speedX; this.y += this.speedY; if (this.x < 0 || this.x > canvas.width) this.speedX *= -1; if (this.y < 0 || this.y > canvas.height) this.speedY *= -1; }
                draw() { ctx.fillStyle = `rgba(212, 175, 55, ${this.opacity})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
            }
            const createParticles = () => { particles = []; const count = (canvas.width * canvas.height) / 15000; for (let i = 0; i < count; i++) particles.push(new Particle()); };
            const animate = () => { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animate); };
            window.addEventListener('resize', () => { resizeCanvas(); createParticles(); });
            resizeCanvas(); createParticles(); animate();
        }

        document.addEventListener('DOMContentLoaded', () => {
            pageHistory.push('page-staff-config');
            initStaffPage();
            initLanguagePage();
            initBackground();
            updateText();
        });
    </script>
</body>
</html>


